===
navigate to test page
%require
===
plwr -S plwr-test open "http://localhost:8599/index.html"
---

===
set a custom header
===
plwr -S plwr-test header X-Custom-One first
---

===
set a second custom header
===
plwr -S plwr-test header X-Custom-Two second
---

===
custom headers are sent with requests
===
plwr -S plwr-test eval "(() => { const x = new XMLHttpRequest(); x.open('GET', 'http://localhost:8598/', false); x.send(); return JSON.parse(x.responseText)['x-custom-one']; })()"
---
first

===
multiple custom headers are sent
===
plwr -S plwr-test eval "(() => { const x = new XMLHttpRequest(); x.open('GET', 'http://localhost:8598/', false); x.send(); return JSON.parse(x.responseText)['x-custom-two']; })()"
---
second

===
overwrite an existing header
===
plwr -S plwr-test header X-Custom-One updated
---

===
overwritten header has new value
===
plwr -S plwr-test eval "(() => { const x = new XMLHttpRequest(); x.open('GET', 'http://localhost:8598/', false); x.send(); return JSON.parse(x.responseText)['x-custom-one']; })()"
---
updated

===
clear all headers
===
plwr -S plwr-test header --clear
---

===
cleared headers are no longer sent
===
plwr -S plwr-test eval "(() => { const x = new XMLHttpRequest(); x.open('GET', 'http://localhost:8598/', false); x.send(); return String(JSON.parse(x.responseText)['x-custom-one']); })()"
---
undefined

===
page still works after clearing headers
===
plwr -S plwr-test text h1
---
Test Page
